!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}n.r(e);var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.scene=e,this.unit=10,this.vx=.2,this.vy=.2,this.sizeX=2,this.sizeY=2,this.posX=0,this.posY=0,this.color="#369",this.alive=!0,this.birth=new Date}var e,n,o;return e=t,(n=[{key:"getWidth",value:function(){return this.sizeX*this.unit}},{key:"render",value:function(){var t=this.scene.ctx;t.beginPath(),t.fillStyle=this.color,t.fillRect(this.posX,this.posY,this.getWidth(),this.getWidth()),t.closePath(),t.fill()}}])&&i(e.prototype,n),o&&i(e,o),t}();function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=function(t){function e(){var t,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(n=a(this,(t=u(e)).call.apply(t,[this].concat(o)))).life=1e3,n}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,o),n=e,(i=[{key:"update",value:function(){new Date-this.birth>this.life&&(this.alive=!1),this.posX+=this.vx,this.posY+=this.vy,this.render()}}])&&s(n.prototype,i),r&&s(n,r),e}();function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function p(t,e){return!e||"object"!==h(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var b=function(t){function e(){var t,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(n=p(this,(t=y(e)).call.apply(t,[this].concat(o)))).vx=0,n.vy=-1,n.state=new Date,n.particleCB=500,n.type=0,n}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(e,o),n=e,(i=[{key:"collide",value:function(t,e){(this.posX<0-this.getWidth()||this.posX>t+this.getWidth()||this.posY<0-this.getWidth()||this.posY>e+this.getWidth())&&(this.alive=!1)}},{key:"createParticle",value:function(){var t=new l(this.scene);t.sizeX=.5,t.sizeY=.5,t.vx=Math.random()-.5,t.vy=Math.random()-.5,t.color="#".concat(Math.random().toString(16).substr(3,6)),t.posX=this.posX+this.getWidth(),t.posY=this.posY+this.getWidth(),this.scene.particles.push(t)}},{key:"update",value:function(){new Date-this.state>=this.particleCB&&(this.createParticle(),this.state=new Date),this.posX+=this.vx,this.posY+=this.vy,this.render()}}])&&f(n.prototype,i),r&&f(n,r),e}();function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function g(t,e){return!e||"object"!==d(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function w(t){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var O=function(t){function e(){var t,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(n=g(this,(t=w(e)).call.apply(t,[this].concat(o)))).init(),n}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(e,o),n=e,(i=[{key:"init",value:function(){this.keydowns={},this.actions={},this.bulletCB=800,this.attackTime=-1,this.registAction("a",this.moveLeft.bind(this)),this.registAction("d",this.moveRight.bind(this)),this.registAction("w",this.moveUp.bind(this)),this.registAction("s",this.moveDown.bind(this)),this.registAction(" ",this.attack.bind(this)),this.bindEvent()}},{key:"moveLeft",value:function(){this.posX-=this.vx}},{key:"moveRight",value:function(){this.posX+=this.vx}},{key:"moveUp",value:function(){this.posY-=this.vy}},{key:"moveDown",value:function(){this.posY+=this.vy}},{key:"attack",value:function(){if(this.attackTime<0){var t=new b(this.scene);t.vy=-1.5,t.sizeX=1,t.sizeY=1,t.type=1,t.color="#fff",t.posX=this.posX+t.getWidth()/2,t.posY=this.posY-t.getWidth(),this.attackTime=this.bulletCB,this.scene.bullets.push(t)}this.attackTime-=1e3/60}},{key:"edge",value:function(){var t=I.WIDTH,e=I.HEIGHT;this.posX<0&&(this.posX=0),this.posX>t-this.getWidth()&&(this.posX=t-this.getWidth()),this.posY<0&&(this.posY=0),this.posY>e-this.getWidth()&&(this.posY=e-this.getWidth())}},{key:"collide",value:function(t){return t.posX<=this.posX+this.getWidth()&&t.posX>=this.posX-t.getWidth()&&t.posY<=this.posY+this.getWidth()&&t.posY>=this.posY-t.getWidth()}},{key:"damage",value:function(){var t=this.scene.bullets.filter(function(t){return!t.type}),e=!0,n=!1,i=void 0;try{for(var o,r=t[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var s=o.value;if(this.collide(s)){s.alive=!1,this.scene.warn=!0;break}}}catch(t){n=!0,i=t}finally{try{e||null==r.return||r.return()}finally{if(n)throw i}}var a=this.scene.enemys,u=!0,c=!1,l=void 0;try{for(var h,f=a[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;if(this.collide(p)){p.alive=!1,this.scene.warn=!0;break}}}catch(t){c=!0,l=t}finally{try{u||null==f.return||f.return()}finally{if(c)throw l}}}},{key:"registAction",value:function(t,e){this.actions[t]=e}},{key:"bindEvent",value:function(){var t=this;window.addEventListener("keydown",function(e){t.keydowns[e.key]=!0}),window.addEventListener("keyup",function(e){t.keydowns[e.key]=!1})}},{key:"update",value:function(){var t=this;this.edge(),this.damage(),Object.keys(this.actions).forEach(function(e){return t.keydowns[e]&&t.actions[e]()}),this.attack(),this.render()}}])&&m(n.prototype,i),r&&m(n,r),e}();function E(t){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function T(t,e){return!e||"object"!==E(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _(t){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function P(t,e){return(P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var X=function(t){function e(){var t,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(n=T(this,(t=_(e)).call.apply(t,[this].concat(o)))).dx=.005,n.dy=0,n.changeCB=500,n.canChange=!0,n.init(),n}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&P(t,e)}(e,o),n=e,(i=[{key:"init",value:function(){this.bulletCB=2e3,this.attackTime=-1,this.boomConfig=new Map([[2,[1.5,1,.5]],[3,[2,2,1]]])}},{key:"collide",value:function(t,e,n){this.posX<0-this.getWidth()&&(this.dx=.01*Math.random()),this.posX>e+this.getWidth()&&(this.dx=.01*-Math.random()),this.posY,this.getWidth(),this.posY>n+this.getWidth()&&(this.alive=!1);var i=t.filter(function(t){return t.type}),o=!0,r=!1,s=void 0;try{for(var a,u=i[Symbol.iterator]();!(o=(a=u.next()).done);o=!0){var c=a.value;if(c.posX<=this.posX+this.getWidth()&&c.posX>=this.posX-c.getWidth()&&c.posY<=this.posY+this.getWidth()&&c.posY>=this.posY-c.getWidth()){this.alive=!1,c.alive=!1,this.scene.killCount++,this.boom();break}}}catch(t){r=!0,s=t}finally{try{o||null==u.return||u.return()}finally{if(r)throw s}}}},{key:"attack",value:function(){if(this.attackTime<0){var t=new b(this.scene);t.sizeX=1,t.sizeY=1,t.type=0,t.vy=.8,t.color=this.color,t.posX=this.posX+t.getWidth()/2,t.posY=this.posY+t.getWidth(),this.attackTime=this.bulletCB,this.scene.bullets.push(t)}this.attackTime-=1e3/60}},{key:"boom",value:function(){var t=this,e=this.boomConfig.get(this.sizeX);e&&e.forEach(function(e){var n=new l(t.scene);n.life=2e3,n.sizeX=e,n.sizeY=e,n.color=t.color,n.vx=.1*Math.random()-.05,n.vy=.1*Math.random()-.05,n.posX=t.posX,n.posY=t.posY,t.scene.particles.push(n)})}},{key:"changeX",value:function(){Math.random()-.5>0&&(this.dx*=-1)}},{key:"changeY",value:function(){Math.random()-.5>0&&(this.dy*=-1)}},{key:"change",value:function(){Date.now()-this.changeTime>this.changeCB&&(this.canChange=!0),this.canChange&&(this.canChange=!1,this.changeX(),this.changeY())}},{key:"update",value:function(){this.change(),this.attack(),this.posX+=this.vx,this.posY+=this.vy,this.vx+=this.dx,this.vy+=this.dy,this.render()}}])&&j(n.prototype,i),r&&j(n,r),e}();function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Y(t,e,n){return(Y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=W(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function W(t){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function C(t,e){return(C=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function H(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function M(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function D(t,e,n){return e&&M(t.prototype,e),n&&M(t,n),t}function z(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var I=function(){function t(e){H(this,t),this.ctx=e}return D(t,[{key:"init",value:function(){return this}},{key:"update",value:function(){}}]),t}();z(I,"WIDTH",500),z(I,"HEIGHT",600),z(I,"START",!0);var A=function(t){function e(){var t,n;H(this,e);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(n=x(this,(t=W(e)).call.apply(t,[this].concat(o)))).setEnemyCD=3e3,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&C(t,e)}(e,I),D(e,[{key:"init",value:function(){Y(W(e.prototype),"init",this).call(this),this.bindEvent(),this.createEnemyTime=-1,this.bullets=[],this.enemys=[],this.particles=[],this.initPlayer(),this.initEnemy(),this.warn=!1,this.killCount=0}},{key:"bindEvent",value:function(){}},{key:"initPlayer",value:function(){this.player=new O(this),this.player.vx=2,this.player.vy=2,this.player.posX=I.WIDTH/2-this.player.getWidth(),this.player.posY=I.HEIGHT-this.player.getWidth()}},{key:"initEnemy",value:function(){if(this.createEnemyTime<0){for(var t=3*Math.random()+1|0;t--;)this.createEnemy();this.createEnemyTime=this.setEnemyCD}this.createEnemyTime-=1e3/60}},{key:"createEnemy",value:function(){var t=new X(this);t.vx=0,t.vy=.5+Math.random(),t.sizeX=3*Math.random()+1|0,t.sizeY=t.sizeX,t.color="hsl(".concat(256*Math.random()|0,", ").concat(40*Math.random()+40|0,"%, ").concat(60*Math.random()+40|0,"%)"),t.posX=Math.random()*I.WIDTH,t.posY=0-t.getWidth(),this.enemys.push(t)}},{key:"warning",value:function(){var t=this.ctx;t.fillStyle="red",t.beginPath(),t.fillRect(0,0,I.WIDTH,I.HEIGHT),t.fill()}},{key:"updateBullet",value:function(){this.bullets.forEach(function(t){return t.update()});for(var t=this.bullets.length-1;t>=0;t--){var e=this.bullets[t];e.collide(I.WIDTH,I.HEIGHT),e.alive?e.update():this.bullets.splice(t,1)}}},{key:"updateParticle",value:function(){this.particles.forEach(function(t){return t.update()});for(var t=this.particles.length-1;t>=0;t--){var e=this.particles[t];e.alive?e.update():this.particles.splice(t,1)}}},{key:"updateEnemy",value:function(){for(var t=this.enemys.length-1;t>=0;t--){var e=this.enemys[t];e.collide(this.bullets,I.WIDTH,I.HEIGHT),e.alive?e.update():this.enemys.splice(t,1)}}},{key:"updateInfo",value:function(){var t=this.ctx;t.fillStyle="#fff",t.font="20px Georgia",t.fillText("调试信息",10,20),t.fillText("子弹数量".concat(this.bullets.length),10,40),t.fillText("敌人数量".concat(this.enemys.length),10,60),t.fillText("击杀数量".concat(this.killCount),10,80)}},{key:"update",value:function(){var t=this.ctx;Y(W(e.prototype),"update",this).call(this),this.initEnemy(),this.warn?(this.warning(),this.warn=!1):t.clearRect(0,0,I.WIDTH,I.HEIGHT),this.player.update(),this.updateBullet(),this.updateParticle(),this.updateEnemy(),this.updateInfo()}}]),e}();function R(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var B=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.manager=[],this.init()}var e,n,i;return e=t,i=[{key:"freeze",value:function(t){t.action=!1}},{key:"unfreeze",value:function(t){t.init(),t.action=!0}}],(n=[{key:"init",value:function(){this.keydowns={},this.actions={},this.work=!0,this.registAction(" ",this.pause.bind(this)),this.bindEvent(),this.update()}},{key:"pause",value:function(){this.work=!this.work}},{key:"add",value:function(t){t.action=!1,this.manager.push(t)}},{key:"remove",value:function(t){for(var e=0;e<this.manager.length;e++)if(t===this.manager[e])return void this.splice(e,1)}},{key:"registAction",value:function(t,e){this.actions[t]=e}},{key:"bindEvent",value:function(){var t=this;window.addEventListener("keyup",function(e){t.actions[e.key]&&t.actions[e.key]()})}},{key:"update",value:function(){this.work&&this.manager.forEach(function(t){return t.action&&t.update()}),requestAnimationFrame(this.update.bind(this))}}])&&R(e.prototype,n),i&&R(e,i),t}(),G=canvas.getContext("2d"),L=new B,U=new A(G);L.add(U),B.unfreeze(U)}]);
